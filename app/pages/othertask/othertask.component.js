"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var router_1 = require("@angular/router");
var core_1 = require("@angular/core");
var observable_array_1 = require("tns-core-modules/data/observable-array");
var dataItem_service_1 = require("../../service/dataItem.service");
var listviewitems_1 = require("../../service/listviewitems");
var timerModule = require("tns-core-modules/timer");
var firebase = require("nativescript-plugin-firebase");
var application_settings_1 = require("application-settings");
var page_1 = require("ui/page");
// import { View } from "ui/core/view";
var OtherTaskComponent = (function () {
    function OtherTaskComponent(router, page) {
        this.router = router;
        this.page = page;
        this.dataItems = new observable_array_1.ObservableArray([]);
        this.detailedDataItems = new observable_array_1.ObservableArray([]);
        this.listViewItems = new listviewitems_1.ListViewItems;
        this.showDetailedView = "collapse";
        this.pageTitle = "Other Task";
    }
    OtherTaskComponent.prototype.ngOnInit = function () {
        this.dataItems = this.listViewItems.getOtherTaskDetails();
    };
    OtherTaskComponent.prototype.onSwipeCellStarted = function (args) {
        var swipeLimits = args.data.swipeLimits;
        var swipeView = args['object'];
        var leftItem = swipeView.getViewById('emptyView');
        var rightItem = swipeView.getViewById('deleteView');
        swipeLimits.left = leftItem.getMeasuredWidth();
        swipeLimits.right = rightItem.getMeasuredWidth();
        swipeLimits.threshold = leftItem.getMeasuredWidth() / 2;
    };
    OtherTaskComponent.prototype.onPullToRefreshInitiated = function (args) {
        this.dataItems = this.listViewItems.getOtherTaskDetails();
        timerModule.setTimeout(function () {
            var listView = args.object;
            listView.notifyPullToRefreshFinished();
        }, 1000);
    };
    OtherTaskComponent.prototype.deleteTask = function (args) {
        var tapIndex = this.dataItems.indexOf(args.object.bindingContext);
        console.log("Item Kay======" + this.dataItems.getItem(tapIndex).key);
        console.log("Task Name======" + this.dataItems.getItem(tapIndex).taskName);
        var createdByNumber = this.dataItems.getItem(tapIndex).createdByNumber;
        //var key=this.dataItems.getItem(tapIndex).key;
        var itemKey = this.dataItems.getItem(tapIndex).key;
        var devicePhoneNumber = application_settings_1.getString("devicePhoneNumber");
        var x = this;
        var onQueryEvent = function (result) {
            console.log("Delete My task");
            if (!result.error) {
                console.log("IF");
                var resultJson = result.value;
                console.log("Result==" + resultJson);
                for (var key1 in resultJson) {
                    console.log("Assignee Number" + key1);
                    if (key1 == null || key1 == "null") { }
                    else {
                        //delete the task in my task details
                        firebase.remove('/MyTaskDetails/' + key1 + '/' + itemKey);
                    }
                }
                x.deleteOtherTask(devicePhoneNumber, tapIndex, itemKey);
            }
        };
        firebase.query(onQueryEvent, '/OtherTaskDetails/' + devicePhoneNumber + '/' + itemKey + '/AssigneeDetails', {
            singleEvent: true,
            orderBy: {
                type: firebase.QueryOrderByType.KEY,
            },
        });
        timerModule.setTimeout(function () {
            x.dataItems = x.listViewItems.getOtherTaskDetails();
        }, 1000);
    };
    OtherTaskComponent.prototype.deleteOtherTask = function (devicePhoneNumber, tapIndex, itemKey) {
        //delete task in other task details page
        firebase.remove('/OtherTaskDetails/' + devicePhoneNumber + '/' + itemKey).then(function (res) {
            console.log("Task has been deleted successfully in other task details---");
        }, function (res) {
            console.log("Problem in deleting other task details---" + res);
        });
    };
    OtherTaskComponent.prototype.cancel = function () {
        this.showDetailedView = "collapse";
    };
    OtherTaskComponent.prototype.getRemainderCountAndUpdate = function (number, cStatus, rCount) {
        var devicePhoneNumber = application_settings_1.getString("devicePhoneNumber");
        firebase.update('/MyTaskDetails/' + number + '/' + this.tappedItemKey, {
            'remainderCount': rCount + 1,
        });
        firebase.update('/OtherTaskDetails/' + devicePhoneNumber + '/' + this.tappedItemKey + '/AssigneeDetails/' + number, {
            'remainderCount': rCount + 1,
        });
    };
    OtherTaskComponent.prototype.sendReminder = function () {
        console.log("tappedItemKey===" + this.tappedItemKey);
        var tappedItemKey = this.tappedItemKey;
        var reminderSendDetails = new observable_array_1.ObservableArray([]);
        var x = this;
        var devicePhoneNumber = application_settings_1.getString("devicePhoneNumber");
        console.log("Length===" + this.detailedDataItems.length);
        for (var i = 0; i < this.detailedDataItems.length; i++) {
            var number = this.detailedDataItems.getItem(i).assigneeNumber;
            var cStatus = this.detailedDataItems.getItem(i).completionStatus;
            var rCount = this.detailedDataItems.getItem(i).remainderCount;
            console.log("Number====" + number);
            console.log("cStatus====" + cStatus);
            console.log("rCount====" + rCount);
            if (!cStatus)
                this.getRemainderCountAndUpdate(number, cStatus, rCount);
        }
        // var tapIndex=this.dataItems.indexOf(tappedItemKey);
        // console.log("Index==="+tapIndex);
        // let overAllRemainderCount=this.dataItems.getItem(tapIndex).remainderCount;
        // console.log("overAllRemainderCount====="+overAllRemainderCount);
        // firebase.update(
        // '/OtherTaskDetails/'+devicePhoneNumber+'/'+tappedItemKey,
        // {
        //     'remainderCount':overAllRemainderCount+1,
        // });
        var onQueryEvent = function (result) {
            if (!result.error) {
                firebase.update('/OtherTaskDetails/' + devicePhoneNumber + '/' + tappedItemKey, {
                    'remainderCount': result.value + 1,
                }).then(function (res) {
                }, function (res) { });
            }
        };
        firebase.query(onQueryEvent, '/OtherTaskDetails/' + devicePhoneNumber + '/' + tappedItemKey + '/remainderCount', {
            singleEvent: true,
            orderBy: {
                type: firebase.QueryOrderByType.KEY,
            },
        });
        timerModule.setTimeout(function () {
            x.dataItems = x.listViewItems.getOtherTaskDetails();
            x.showDetailedView = "collapse";
        }, 500);
    };
    OtherTaskComponent.prototype.itemTap = function (item) {
        console.log("ITem Key==" + item.key);
        this.tappedItemKey = item.key;
        console.log("tappedItemKey===" + this.tappedItemKey);
        this.detailedDataItems = this.listViewItems.getOtherTaskDetailsDetailedDetails(item.key);
        this.showDetailedView = "visible";
        // var layout = this.page;
        // var idName="taskDetailedView"+item.key;
        // var detailedViewLayout = layout.getViewById(idName);
        // console.log("ID==="+detailedViewLayout);
        // console.log(" class=="+detailedViewLayout.className.split(" ")[1]);
        //  layout.className="taskDetailedView";
        //var classLayout=layout.className="taskDetailedView";
        // console.log("Calss Layout=="+classLayout);
        // layout.set("class","taskDetailedView hide");
        // if(detailedViewLayout.className.split(" ")[1]=='show')
        // {
        //     // console.log("IF==");
        //     detailedViewLayout.set("class","taskDetailedView hide");
        // }
        // else{
        //     // console.log("ELSE==");
        //     detailedViewLayout.set("class","taskDetailedView show");
        // }
        //detailedViewLayout.set("visibility","visible");
        //var taskField = layout.getViewById("taskName");
    };
    OtherTaskComponent.prototype.createTask = function () {
        this.router.navigate(["/createtask"]);
    };
    return OtherTaskComponent;
}());
OtherTaskComponent = __decorate([
    core_1.Component({
        selector: "my-app",
        providers: [dataItem_service_1.DataItemService],
        templateUrl: "pages/othertask/othertask.html",
        styleUrls: ["pages/othertask/othertask-common.css", "pages/othertask/othertask.css"]
    }),
    __metadata("design:paramtypes", [router_1.Router, page_1.Page])
], OtherTaskComponent);
exports.OtherTaskComponent = OtherTaskComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3RoZXJ0YXNrLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm90aGVydGFzay5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwwQ0FBeUM7QUFDekMsc0NBQWtEO0FBQ2xELDJFQUF5RTtBQUV6RSxtRUFBaUU7QUFHakUsNkRBQTREO0FBRTVELG9EQUF1RDtBQUN2RCx1REFBMEQ7QUFDMUQsNkRBVThCO0FBQzlCLGdDQUErQjtBQUMvQix1Q0FBdUM7QUFRdkMsSUFBYSxrQkFBa0I7SUFXM0IsNEJBQW9CLE1BQWMsRUFBUyxJQUFVO1FBQWpDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFNO1FBVHJELGNBQVMsR0FBQyxJQUFJLGtDQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEMsc0JBQWlCLEdBQUUsSUFBSSxrQ0FBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBU3ZDLElBQUksQ0FBQyxhQUFhLEdBQUMsSUFBSSw2QkFBYSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxnQkFBZ0IsR0FBQyxVQUFVLENBQUM7UUFDakMsSUFBSSxDQUFDLFNBQVMsR0FBQyxZQUFZLENBQUM7SUFFaEMsQ0FBQztJQUVELHFDQUFRLEdBQVI7UUFFSSxJQUFJLENBQUMsU0FBUyxHQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUM1RCxDQUFDO0lBQ00sK0NBQWtCLEdBQXpCLFVBQTBCLElBQXVCO1FBRTdDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3hDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQixJQUFJLFFBQVEsR0FBRyxTQUFTLENBQUMsV0FBVyxDQUFPLFdBQVcsQ0FBQyxDQUFDO1FBQ3hELElBQUksU0FBUyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQU8sWUFBWSxDQUFDLENBQUM7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IFwiQGFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9kYXRhL29ic2VydmFibGUtYXJyYXlcIjtcbmltcG9ydCB7IERhdGFJdGVtIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2UvZGF0YUl0ZW1cIjtcbmltcG9ydCB7IERhdGFJdGVtU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlL2RhdGFJdGVtLnNlcnZpY2VcIjtcbmltcG9ydCB7IExpc3RWaWV3RXZlbnREYXRhLCBSYWRMaXN0VmlldyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtdGVsZXJpay11aS1wcm8vbGlzdHZpZXdcIjtcbmltcG9ydCB7IFZpZXcgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9jb3JlL3ZpZXdcIjtcbmltcG9ydCB7IExpc3RWaWV3SXRlbXMgfSBmcm9tIFwiLi4vLi4vc2VydmljZS9saXN0dmlld2l0ZW1zXCI7XG5pbXBvcnQgeyBSYWRMaXN0Vmlld0NvbXBvbmVudCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtdGVsZXJpay11aS1wcm8vbGlzdHZpZXcvYW5ndWxhclwiO1xuaW1wb3J0ICogYXMgdGltZXJNb2R1bGUgIGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3RpbWVyXCI7XG5pbXBvcnQgZmlyZWJhc2UgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZVwiKTtcbmltcG9ydCB7XG4gICAgZ2V0Qm9vbGVhbixcbiAgICBzZXRCb29sZWFuLFxuICAgIGdldE51bWJlcixcbiAgICBzZXROdW1iZXIsXG4gICAgZ2V0U3RyaW5nLFxuICAgIHNldFN0cmluZyxcbiAgICBoYXNLZXksXG4gICAgcmVtb3ZlLFxuICAgIGNsZWFyXG59IGZyb20gXCJhcHBsaWNhdGlvbi1zZXR0aW5nc1wiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG4vLyBpbXBvcnQgeyBWaWV3IH0gZnJvbSBcInVpL2NvcmUvdmlld1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwibXktYXBwXCIsXG4gIHByb3ZpZGVyczogW0RhdGFJdGVtU2VydmljZV0sXG4gIHRlbXBsYXRlVXJsOiBcInBhZ2VzL290aGVydGFzay9vdGhlcnRhc2suaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcInBhZ2VzL290aGVydGFzay9vdGhlcnRhc2stY29tbW9uLmNzc1wiLCBcInBhZ2VzL290aGVydGFzay9vdGhlcnRhc2suY3NzXCJdXG59KVxuZXhwb3J0IGNsYXNzIE90aGVyVGFza0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdFxue1xuICAgIGRhdGFJdGVtcz1uZXcgT2JzZXJ2YWJsZUFycmF5KFtdKTtcbiAgICBkZXRhaWxlZERhdGFJdGVtcz0gbmV3IE9ic2VydmFibGVBcnJheShbXSk7XG4gICAgbGlzdFZpZXdJdGVtczpMaXN0Vmlld0l0ZW1zO1xuICAgIHRhcHBlZEl0ZW1LZXk7XG4gICAgXG4gICAgcGFnZVRpdGxlO1xuICAgXG4gICAgc2hvd0RldGFpbGVkVmlldztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIscHJpdmF0ZSBwYWdlOiBQYWdlKSB7XG4gICAgICAgIHRoaXMubGlzdFZpZXdJdGVtcz1uZXcgTGlzdFZpZXdJdGVtcztcbiAgICAgICAgdGhpcy5zaG93RGV0YWlsZWRWaWV3PVwiY29sbGFwc2VcIjtcbiAgICAgICAgdGhpcy5wYWdlVGl0bGU9XCJPdGhlciBUYXNrXCI7XG4gICAgICAgIFxuICAgIH1cblxuICAgIG5nT25Jbml0KCkgXG4gICAge1xuICAgICAgICB0aGlzLmRhdGFJdGVtcz10aGlzLmxpc3RWaWV3SXRlbXMuZ2V0T3RoZXJUYXNrRGV0YWlscygpOyAgXG4gICAgfVxuICAgIHB1YmxpYyBvblN3aXBlQ2VsbFN0YXJ0ZWQoYXJnczogTGlzdFZpZXdFdmVudERhdGEpXG4gICAge1xuICAgICAgICB2YXIgc3dpcGVMaW1pdHMgPSBhcmdzLmRhdGEuc3dpcGVMaW1pdHM7XG4gICAgICAgIHZhciBzd2lwZVZpZXcgPSBhcmdzWydvYmplY3QnXTtcbiAgICAgICAgdmFyIGxlZnRJdGVtID0gc3dpcGVWaWV3LmdldFZpZXdCeUlkPFZpZXc+KCdlbXB0eVZpZXcnKTtcbiAgICAgICAgdmFyIHJpZ2h0SXRlbSA9IHN3aXBlVmlldy5nZXRWaWV3QnlJZDxWaWV3PignZGVsZXRlVmlldycpO1xuICAgICAgICBzd2lwZUxpbWl0cy5sZWZ0ID0gbGVmdEl0ZW0uZ2V0TWVhc3VyZWRXaWR0aCgpO1xuICAgICAgICBzd2lwZUxpbWl0cy5yaWdodCA9IHJpZ2h0SXRlbS5nZXRNZWFzdXJlZFdpZHRoKCk7XG4gICAgICAgIHN3aXBlTGltaXRzLnRocmVzaG9sZCA9IGxlZnRJdGVtLmdldE1lYXN1cmVkV2lkdGgoKSAvIDI7XG4gICAgfVxuXG4gICAgcHVibGljIG9uUHVsbFRvUmVmcmVzaEluaXRpYXRlZChhcmdzOiBMaXN0Vmlld0V2ZW50RGF0YSlcbiAgICB7XG4gICAgICAgIHRoaXMuZGF0YUl0ZW1zPXRoaXMubGlzdFZpZXdJdGVtcy5nZXRPdGhlclRhc2tEZXRhaWxzKCk7ICAgIFxuICAgICAgICB0aW1lck1vZHVsZS5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpXG4gICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgbGlzdFZpZXcgPSBhcmdzLm9iamVjdDtcbiAgICAgICAgICAgICAgICBsaXN0Vmlldy5ub3RpZnlQdWxsVG9SZWZyZXNoRmluaXNoZWQoKTtcbiAgICAgICAgICAgIH0sMTAwMCk7ICAgIFxuXG4gICB9XG4gICBkZWxldGVUYXNrKGFyZ3MpXG4gICB7XG4gICAgXG4gICAgICAgIHZhciB0YXBJbmRleD10aGlzLmRhdGFJdGVtcy5pbmRleE9mKGFyZ3Mub2JqZWN0LmJpbmRpbmdDb250ZXh0KVxuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiSXRlbSBLYXk9PT09PT1cIit0aGlzLmRhdGFJdGVtcy5nZXRJdGVtKHRhcEluZGV4KS5rZXkpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlRhc2sgTmFtZT09PT09PVwiK3RoaXMuZGF0YUl0ZW1zLmdldEl0ZW0odGFwSW5kZXgpLnRhc2tOYW1lKTtcbiAgICAgICAgdmFyIGNyZWF0ZWRCeU51bWJlcj10aGlzLmRhdGFJdGVtcy5nZXRJdGVtKHRhcEluZGV4KS5jcmVhdGVkQnlOdW1iZXI7XG4gICAgICAgIC8vdmFyIGtleT10aGlzLmRhdGFJdGVtcy5nZXRJdGVtKHRhcEluZGV4KS5rZXk7XG4gICAgICAgIHZhciBpdGVtS2V5PXRoaXMuZGF0YUl0ZW1zLmdldEl0ZW0odGFwSW5kZXgpLmtleTtcbiAgICAgICAgdmFyIGRldmljZVBob25lTnVtYmVyPWdldFN0cmluZyhcImRldmljZVBob25lTnVtYmVyXCIpO1xuXG4gICAgICAgIHZhciB4PXRoaXM7XG4gICAgICAgIHZhciBvblF1ZXJ5RXZlbnQ9ZnVuY3Rpb24ocmVzdWx0KVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlbGV0ZSBNeSB0YXNrXCIpO1xuICAgICAgICAgICAgaWYgKCFyZXN1bHQuZXJyb3IpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJRlwiKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0SnNvbj1yZXN1bHQudmFsdWU7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXN1bHQ9PVwiK3Jlc3VsdEpzb24pO1xuICAgICAgICAgICAgICAgIGZvcih2YXIga2V5MSBpbiByZXN1bHRKc29uKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBc3NpZ25lZSBOdW1iZXJcIitrZXkxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoa2V5MT09bnVsbCB8fCBrZXkxPT1cIm51bGxcIil7fVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZGVsZXRlIHRoZSB0YXNrIGluIG15IHRhc2sgZGV0YWlsc1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyZWJhc2UucmVtb3ZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgJy9NeVRhc2tEZXRhaWxzLycra2V5MSsnLycraXRlbUtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gIFxuICAgICAgICAgICAgICAgIHguZGVsZXRlT3RoZXJUYXNrKGRldmljZVBob25lTnVtYmVyLHRhcEluZGV4LGl0ZW1LZXkpOyAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG4gICAgICAgIH0gICBcbiAgICAgICAgZmlyZWJhc2UucXVlcnkoXG4gICAgICAgICAgb25RdWVyeUV2ZW50LFxuICAgICAgICAnL090aGVyVGFza0RldGFpbHMvJytkZXZpY2VQaG9uZU51bWJlcisnLycraXRlbUtleSsnL0Fzc2lnbmVlRGV0YWlscycsXG4gICAgICAgICAge1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgc2luZ2xlRXZlbnQ6IHRydWUsXG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBmaXJlYmFzZS5RdWVyeU9yZGVyQnlUeXBlLktFWSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aW1lck1vZHVsZS5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpXG4gICAgICAgIHtcblxuICAgICAgICAgICAgICAgeC5kYXRhSXRlbXM9eC5saXN0Vmlld0l0ZW1zLmdldE90aGVyVGFza0RldGFpbHMoKTtcbiAgICAgICAgfSwxMDAwKTtcbiAgICAgICAgXG5cblxuICAgICAgICBcbiAgICAgICBcbiAgIH1cbiAgIHB1YmxpYyBkZWxldGVPdGhlclRhc2soZGV2aWNlUGhvbmVOdW1iZXIsdGFwSW5kZXgsaXRlbUtleSlcbiAgICB7XG4gICAgICAgICAgICAgICAgLy9kZWxldGUgdGFzayBpbiBvdGhlciB0YXNrIGRldGFpbHMgcGFnZVxuICAgICAgICAgICAgICAgICBmaXJlYmFzZS5yZW1vdmUoXG4gICAgICAgICAgICAgICAgJy9PdGhlclRhc2tEZXRhaWxzLycrZGV2aWNlUGhvbmVOdW1iZXIrJy8nK2l0ZW1LZXksXG4gICAgICAgICAgICAgICAgKS50aGVuKFxuICAgICAgICAgICAgICAgICAgKHJlcyk9PntcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUYXNrIGhhcyBiZWVuIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IGluIG90aGVyIHRhc2sgZGV0YWlscy0tLVwiKTtcbiAgICAgICAgICAgICAgICAgIH0sKHJlcyk9PntcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQcm9ibGVtIGluIGRlbGV0aW5nIG90aGVyIHRhc2sgZGV0YWlscy0tLVwiK3Jlcyk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICB9ICAgXG4gICAgY2FuY2VsKClcbiAgICB7XG4gICAgICAgIHRoaXMuc2hvd0RldGFpbGVkVmlldz1cImNvbGxhcHNlXCI7XG4gICAgfVxuICAgIHB1YmxpYyBnZXRSZW1haW5kZXJDb3VudEFuZFVwZGF0ZShudW1iZXIsY1N0YXR1cyxyQ291bnQpXG4gICAge1xuICAgICAgICB2YXIgZGV2aWNlUGhvbmVOdW1iZXI9Z2V0U3RyaW5nKFwiZGV2aWNlUGhvbmVOdW1iZXJcIik7XG4gICAgICAgIGZpcmViYXNlLnVwZGF0ZShcbiAgICAgICAgJy9NeVRhc2tEZXRhaWxzLycrbnVtYmVyKycvJyt0aGlzLnRhcHBlZEl0ZW1LZXksXG4gICAgICAgIHtcbiAgICAgICAgICAgICdyZW1haW5kZXJDb3VudCc6ckNvdW50KzEsXG4gICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgZmlyZWJhc2UudXBkYXRlKFxuICAgICAgICAnL090aGVyVGFza0RldGFpbHMvJytkZXZpY2VQaG9uZU51bWJlcisnLycrdGhpcy50YXBwZWRJdGVtS2V5KycvQXNzaWduZWVEZXRhaWxzLycrbnVtYmVyLFxuICAgICAgICB7XG4gICAgICAgICAgICAncmVtYWluZGVyQ291bnQnOnJDb3VudCsxLFxuICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuICAgIHNlbmRSZW1pbmRlcigpXG4gICAge1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJ0YXBwZWRJdGVtS2V5PT09XCIrdGhpcy50YXBwZWRJdGVtS2V5KTsgXG4gICAgICAgIGxldCB0YXBwZWRJdGVtS2V5PXRoaXMudGFwcGVkSXRlbUtleTtcbiAgICAgICAgbGV0IHJlbWluZGVyU2VuZERldGFpbHM9bmV3IE9ic2VydmFibGVBcnJheShbXSk7XG4gICAgICAgICB2YXIgeD10aGlzO1xuICAgICAgICB2YXIgZGV2aWNlUGhvbmVOdW1iZXI9Z2V0U3RyaW5nKFwiZGV2aWNlUGhvbmVOdW1iZXJcIik7XG4gICAgICAgICBjb25zb2xlLmxvZyhcIkxlbmd0aD09PVwiK3RoaXMuZGV0YWlsZWREYXRhSXRlbXMubGVuZ3RoKTtcbiAgICAgICAgZm9yKHZhciBpPTA7aTx0aGlzLmRldGFpbGVkRGF0YUl0ZW1zLmxlbmd0aDtpKyspXG4gICAgICAgIHtcbiAgICAgICAgICAgXG4gICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG51bWJlcj10aGlzLmRldGFpbGVkRGF0YUl0ZW1zLmdldEl0ZW0oaSkuYXNzaWduZWVOdW1iZXI7XG4gICAgICAgICAgICB2YXIgY1N0YXR1cz10aGlzLmRldGFpbGVkRGF0YUl0ZW1zLmdldEl0ZW0oaSkuY29tcGxldGlvblN0YXR1cztcbiAgICAgICAgICAgIHZhciByQ291bnQ9dGhpcy5kZXRhaWxlZERhdGFJdGVtcy5nZXRJdGVtKGkpLnJlbWFpbmRlckNvdW50O1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJOdW1iZXI9PT09XCIrbnVtYmVyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY1N0YXR1cz09PT1cIitjU3RhdHVzKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwickNvdW50PT09PVwiK3JDb3VudCk7XG4gICAgICAgICAgICBpZighY1N0YXR1cylcbiAgICAgICAgICAgIHRoaXMuZ2V0UmVtYWluZGVyQ291bnRBbmRVcGRhdGUobnVtYmVyLGNTdGF0dXMsckNvdW50KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZhciB0YXBJbmRleD10aGlzLmRhdGFJdGVtcy5pbmRleE9mKHRhcHBlZEl0ZW1LZXkpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkluZGV4PT09XCIrdGFwSW5kZXgpO1xuICAgICAgICAvLyBsZXQgb3ZlckFsbFJlbWFpbmRlckNvdW50PXRoaXMuZGF0YUl0ZW1zLmdldEl0ZW0odGFwSW5kZXgpLnJlbWFpbmRlckNvdW50O1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm92ZXJBbGxSZW1haW5kZXJDb3VudD09PT09XCIrb3ZlckFsbFJlbWFpbmRlckNvdW50KTtcbiAgICAgICAgLy8gZmlyZWJhc2UudXBkYXRlKFxuICAgICAgICAvLyAnL090aGVyVGFza0RldGFpbHMvJytkZXZpY2VQaG9uZU51bWJlcisnLycrdGFwcGVkSXRlbUtleSxcbiAgICAgICAgLy8ge1xuICAgICAgICAvLyAgICAgJ3JlbWFpbmRlckNvdW50JzpvdmVyQWxsUmVtYWluZGVyQ291bnQrMSxcbiAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgdmFyIG9uUXVlcnlFdmVudD1mdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgICAgaWYoIXJlc3VsdC5lcnJvcilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaXJlYmFzZS51cGRhdGUoXG4gICAgICAgICAgICAgICAgJy9PdGhlclRhc2tEZXRhaWxzLycrZGV2aWNlUGhvbmVOdW1iZXIrJy8nK3RhcHBlZEl0ZW1LZXksXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAncmVtYWluZGVyQ291bnQnOnJlc3VsdC52YWx1ZSsxLFxuICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlcyk9PntcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSwocmVzKT0+e30pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZpcmViYXNlLnF1ZXJ5KFxuICAgICAgICAgIG9uUXVlcnlFdmVudCxcbiAgICAgICAgJy9PdGhlclRhc2tEZXRhaWxzLycrZGV2aWNlUGhvbmVOdW1iZXIrJy8nK3RhcHBlZEl0ZW1LZXkrJy9yZW1haW5kZXJDb3VudCcsXG4gICAgICAgICAge1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgc2luZ2xlRXZlbnQ6IHRydWUsXG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBmaXJlYmFzZS5RdWVyeU9yZGVyQnlUeXBlLktFWSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aW1lck1vZHVsZS5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHguZGF0YUl0ZW1zPXgubGlzdFZpZXdJdGVtcy5nZXRPdGhlclRhc2tEZXRhaWxzKCk7XG4gICAgICAgICAgICB4LnNob3dEZXRhaWxlZFZpZXc9XCJjb2xsYXBzZVwiOyBcbiAgICAgICAgfSw1MDApO1xuICAgICAgICBcblxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgXG5cblxuICAgIH1cbiAgICBpdGVtVGFwKGl0ZW0pXG4gICAge1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJJVGVtIEtleT09XCIraXRlbS5rZXkpO1xuICAgICAgICB0aGlzLnRhcHBlZEl0ZW1LZXk9aXRlbS5rZXk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidGFwcGVkSXRlbUtleT09PVwiK3RoaXMudGFwcGVkSXRlbUtleSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRldGFpbGVkRGF0YUl0ZW1zPXRoaXMubGlzdFZpZXdJdGVtcy5nZXRPdGhlclRhc2tEZXRhaWxzRGV0YWlsZWREZXRhaWxzKGl0ZW0ua2V5KTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc2hvd0RldGFpbGVkVmlldz1cInZpc2libGVcIjtcblxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgICBcblxuICAgICAgICAvLyB2YXIgbGF5b3V0ID0gdGhpcy5wYWdlO1xuICAgICAgICBcblxuXG4gICAgICAgIC8vIHZhciBpZE5hbWU9XCJ0YXNrRGV0YWlsZWRWaWV3XCIraXRlbS5rZXk7XG4gICAgICAgIC8vIHZhciBkZXRhaWxlZFZpZXdMYXlvdXQgPSBsYXlvdXQuZ2V0Vmlld0J5SWQoaWROYW1lKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJJRD09PVwiK2RldGFpbGVkVmlld0xheW91dCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiIGNsYXNzPT1cIitkZXRhaWxlZFZpZXdMYXlvdXQuY2xhc3NOYW1lLnNwbGl0KFwiIFwiKVsxXSk7XG5cbiAgICAgIC8vICBsYXlvdXQuY2xhc3NOYW1lPVwidGFza0RldGFpbGVkVmlld1wiO1xuICAgICAgICAvL3ZhciBjbGFzc0xheW91dD1sYXlvdXQuY2xhc3NOYW1lPVwidGFza0RldGFpbGVkVmlld1wiO1xuICAgICAgIC8vIGNvbnNvbGUubG9nKFwiQ2Fsc3MgTGF5b3V0PT1cIitjbGFzc0xheW91dCk7XG4gICAgICAgLy8gbGF5b3V0LnNldChcImNsYXNzXCIsXCJ0YXNrRGV0YWlsZWRWaWV3IGhpZGVcIik7XG5cblxuICAgICAgICAvLyBpZihkZXRhaWxlZFZpZXdMYXlvdXQuY2xhc3NOYW1lLnNwbGl0KFwiIFwiKVsxXT09J3Nob3cnKVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICAvLyBjb25zb2xlLmxvZyhcIklGPT1cIik7XG4gICAgICAgIC8vICAgICBkZXRhaWxlZFZpZXdMYXlvdXQuc2V0KFwiY2xhc3NcIixcInRhc2tEZXRhaWxlZFZpZXcgaGlkZVwiKTtcbiAgICAgICAgICAgIFxuICAgICAgICAvLyB9XG4gICAgICAgIC8vIGVsc2V7XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKFwiRUxTRT09XCIpO1xuICAgICAgICAvLyAgICAgZGV0YWlsZWRWaWV3TGF5b3V0LnNldChcImNsYXNzXCIsXCJ0YXNrRGV0YWlsZWRWaWV3IHNob3dcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8vZGV0YWlsZWRWaWV3TGF5b3V0LnNldChcInZpc2liaWxpdHlcIixcInZpc2libGVcIik7XG4gICAgICAgIC8vdmFyIHRhc2tGaWVsZCA9IGxheW91dC5nZXRWaWV3QnlJZChcInRhc2tOYW1lXCIpO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBjcmVhdGVUYXNrKCl7XG4gICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvY3JlYXRldGFza1wiXSk7XG5cbiAgICB9XG4gICBcbn1cblxuXG5cbiJdfQ==